<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.spring.goods.dao.GoodsMapper">
	<!-- 상품 정보 등록 -->
	<insert id="insertGoods" parameterType="goodsVO">
		INSERT INTO goods(
			goods_num,
			goods_name,
			goods_category,
			goods_price,
			goods_disc,
			goods_dprice,
			goods_content,
			goods_photo,
			goods_status)
		VALUES(
			#{goods_num},
			#{goods_name},
			#{goods_category},
			#{goods_price},
			#{goods_disc},
			#{goods_dprice},
			#{goods_content},
			#{goods_photo},
			#{goods_status})
	</insert>
	
	<!-- 상품 목록 -->
	<sql id="goodsSearch">
		<where>
			<if test="keyfield != null and keyword != ''">
				<if test="keyfield == 1">
					g.goods_category == 1 and 
					g.goods_name LIKE '%' || #{keyword} || '%'
				</if>
				<if test="keyfield == 2">
					g.goods_category == 2 and 
					g.goods_name LIKE '%' || #{keyword} || '%'
				</if>
			</if>
		</where>
	</sql>
	
	<sql id="goodsOrder">
		<if test="order == 1">
			ORDER BY goods_num DESC
		</if>
		<if test="order == 2">
			ORDER BY fav_cnt DESC
		</if>
		<if test="order == 3">
			ORDER BY re_cnt DESC
		</if>
	</sql>
	  
	<!-- 전체/검색 레코드 수 -->
	<select id="selectGoodsRowCount" parameterType="map" resultType="integer">
		SELECT 
			count(*) 
		FROM goods
		<include refid="goodsSearch"></include>
	</select>
	
	<!-- 전체/검색 목록 -->
	<select id="selectGoodsList" parameterType="map" resultType="goodsVO">
		SELECT
			*
		FROM (SELECT
				a.*,
				rownum rnum
			  FROM(SELECT
			  			*
			  	   FROM goods g JOIN goods_option o
			  	   USING(goods_num)
			  	   <include refid="goodsSearch"></include>
			  	   <include refid="goodsOrder"></include>
			  	   )a)
		<![CDATA[
		WHERE rnum >= #{start} AND rnum <= #{end}
		]]>
	</select>
	
	<!-- 굿즈 상세 -->
	<select id="selectGoods" parameterType="integer">
		SELECT
			*
		FROM goods g JOIN goods_option o 
		ON g.goods_num=o.goods_num
		WHERE g.goods_num=#{goods_num}
	</select>
	
</mapper>